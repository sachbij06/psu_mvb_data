<!DOCTYPE html>
<html>
<head>

<title>PSU MVB - Individual Play Data</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<style>
        #category-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        padding: 10px;
        background-color: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        }

        #category-buttons button {
        background-color: #ffffff;
        color: #0c1c44;
        border: 1px solid #0c1c44;
        padding: 12px 20px;
        font-family: 'Roboto Condensed', sans-serif;
        font-size: 15px;
        font-weight: 500;
        }

        #weeks-content {
    justify-content: center;
    align-items: center;
    margin: 20px;
        }

        .calendar-container {
            width: 85%;
            max-width: 600px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            background: #778da9;
            padding: 30px;
        }

        .calendar-header {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .week-box {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #0c1c44;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-size: 14px;
            transition: all 0.3s ease-in-out;
        }

        .week-box:hover {
            background: #586c86;
            transform: scale(1.05);
        }

        .week-box.selected {
            background: #586c86;
            color: #fff;
            border-color: #586c86;
        }

        .selected-practice {
            background-color: #4caf50;
            color: #fff;
        }

        .selected-week {
            background-color: #4caf50;
            color: #fff;
        }

        .selected-month {
            background-color: #4caf50;
            color: #fff;
        }


</style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="logo-container">
            <a href="/home">
                <img src="static/penn state pictures/psu_logo.png" alt="PSU Logo" class="logo">
            </a>
            <h1>Individual On Court Performance</h1>
        </div>
        <nav>
            <ul class="tabs">
                <li class="dropdown-container">
                    <button>Team</button>
                    <ul class="dropdown-menu">
                        <li><a href="/team_strength">Strength and Conditioning</a></li>
                        <li><a href="/team_oncourt">On-Court Performance</a></li>
                    </ul>
                </li>
                <li class="dropdown-container">
                    <button>Individual</button>
                    <ul class="dropdown-menu">
                        <li><a href="/player_strength">Strength and Conditioning</a></li>
                        <li><a href="/player_oncourt">On-Court Performance</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <!-- MAIN CONTENT -->
    <div class="main-container">

        <aside class="sidebar">

            <div class="player-profile" id="player-profile">

                <div class="player-select">
                    <select id="player-selector" onchange="updatePlayerProfile()"></select> <!-- CURRENTLY HIDDEN -->
                </div>
                
            </div>

           

            <!-- Practices Section -->
        <div id="practices" class="section" onclick="toggleSection('practices')">Practices</div>
        <div id="practices-content" class="content">
            <div class="navigation-buttons">
                <button onclick="previousWeek()">Previous Week</button>
                <button onclick="nextWeek()">Next Week</button>
            </div>
            <div class="practice-blocks" id="practiceBlocks">
                <!-- Days dynamically generated by JavaScript -->
            </div>
            
        </div>

            <!-- Weeks Section -->
        <div id="weeks" class="section" onclick="toggleSection('weeks')">Weeks</div>
        <div id="weeks-content" class="content">
            <div class="calendar-container">
                <div class="calendar-header">
                    <span>Select a Week</span>
                </div>
                <div class="calendar-grid">
                    <!-- Dynamic week boxes will be generated here -->
                </div>
            </div>
        </div>
        

        <!-- Months Section -->
        <div id="months" class="section" onclick="toggleSection('months')">Months</div>
        <div id="months-content" class="content">
            <div class="months-table">
                <div class="month-box">Month 1 | Sept.</div>
                <div class="month-box">Month 2 | Oct.</div>
                <div class="month-box">Month 3 | Nov.</div>
                <div class="month-box">Month 4 | Dec.</div>
            </div>
        </div>



        <!-- All Time Button -->
        <div class="section" onclick="resetSections()">All Time</div>
    </aside>

        <!-- MAIN DASHBOARD AREA -->
        <main class="dashboard">
        
            <!-- Selected Time Periods Section -->
            <div id="selected-practices-container">
                <h2 id ="selected-practices-h2">Selected Practices</h2>
                <ul id="selected-practices-list">
                    <!-- Dynamically populated -->
                </ul>
        
                <!-- Selected-Time Calendar -->
                <div class="selected-time-calendar-container">
                    <!-- September -->
                    <div class="selected-time-month-box">
                        <div class="selected-time-month-header">September</div>
                        <div class="selected-time-day-labels">
                            <div class="selected-time-day-label">SU</div>
                            <div class="selected-time-day-label">M</div>
                            <div class="selected-time-day-label">T</div>
                            <div class="selected-time-day-label">W</div>
                            <div class="selected-time-day-label">TH</div>
                            <div class="selected-time-day-label">F</div>
                            <div class="selected-time-day-label">S</div>
                        </div>
                        <div class="selected-time-calendar-grid">
                            <script>
                                // Generate September Calendar
                                let startDay = 0; // Sunday (0 = Sunday, 1 = Monday, ...)
                                let daysInMonth = 30;
                                let month = 9; // September (month as number)

                                for (let i = 0; i < startDay; i++) {
                                    document.write('<div class="selected-time-empty-day"></div>');
                                }
                                for (let i = 1; i <= daysInMonth; i++) {
                                    let dayOfWeek = (startDay + i - 1) % 7;
                                    let isWeekend = (dayOfWeek === 0 || dayOfWeek === 6); // Sunday or Saturday
                                    const fullDate = `${month}/${i}`; // Format as "month/day"

                                    if (isWeekend) {
                                        document.write(`<div class="selected-time-calendar-day blocked" data-date="${fullDate}" data-tooltip="Weekend: No Practice">${i}</div>`);
                                    } else {
                                        document.write(`<div class="selected-time-calendar-day" data-date="${fullDate}">${i}</div>`);
                                    }
                                }
                            </script>
                        </div>
                    </div>
        
                    <!-- October -->
                    <div class="selected-time-month-box">
                        <div class="selected-time-month-header">October</div>
                        <div class="selected-time-day-labels">
                            <div class="selected-time-day-label">SU</div>
                            <div class="selected-time-day-label">M</div>
                            <div class="selected-time-day-label">T</div>
                            <div class="selected-time-day-label">W</div>
                            <div class="selected-time-day-label">TH</div>
                            <div class="selected-time-day-label">F</div>
                            <div class="selected-time-day-label">S</div>
                        </div>
                        <div class="selected-time-calendar-grid">
                            <script>
                                // Generate October Calendar
                                startDay = 2; // Tuesday (October starts on a Tuesday)
                                daysInMonth = 31;

                                for (let i = 0; i < startDay; i++) {
                                    document.write('<div class="selected-time-empty-day"></div>');
                                }
                                for (let i = 1; i <= daysInMonth; i++) {
                                    let dayOfWeek = (startDay + i - 1) % 7;
                                    let isWeekend = (dayOfWeek === 0 || dayOfWeek === 6); // Sunday or Saturday
                                    const fullDate = `10/${i}`; // Format as "month/day"

                                    if (isWeekend) {
                                        document.write(`<div class="selected-time-calendar-day blocked" data-date="${fullDate}" data-tooltip="Weekend: No Practice">${i}</div>`);
                                    } else {
                                        document.write(`<div class="selected-time-calendar-day" data-date="${fullDate}">${i}</div>`);
                }
            }
                            </script>
                        </div>
                    </div>
        
                    <!-- November -->
                    <div class="selected-time-month-box">
                        <div class="selected-time-month-header">November</div>
                        <div class="selected-time-day-labels">
                            <div class="selected-time-day-label">SU</div>
                            <div class="selected-time-day-label">M</div>
                            <div class="selected-time-day-label">T</div>
                            <div class="selected-time-day-label">W</div>
                            <div class="selected-time-day-label">TH</div>
                            <div class="selected-time-day-label">F</div>
                            <div class="selected-time-day-label">S</div>
                        </div>
                        <div class="selected-time-calendar-grid">
                            <script>
                                // Generate November Calendar
                                startDay = 5; // Friday (November starts on a Friday)
                                daysInMonth = 30;

                                for (let i = 0; i < startDay; i++) {
                                    document.write('<div class="selected-time-empty-day"></div>');
                                }
                                for (let i = 1; i <= daysInMonth; i++) {
                                    let dayOfWeek = (startDay + i - 1) % 7;
                                    let isWeekend = (dayOfWeek === 0 || dayOfWeek === 6); // Sunday or Saturday
                                    const fullDate = `11/${i}`; // Format as "month/day"

                                    if (isWeekend) {
                                        document.write(`<div class="selected-time-calendar-day blocked" data-date="${fullDate}" data-tooltip="Weekend: No Practice">${i}</div>`);
                                    } else if (i >= 23) { // Special condition for blocked days after 23rd
                                        document.write(`<div class="selected-time-calendar-day blocked" data-date="${fullDate}" data-tooltip="Blocked: No Practice">${i}</div>`);
                                    } else {
                                        document.write(`<div class="selected-time-calendar-day" data-date="${fullDate}">${i}</div>`);
                                    }
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Buttons -->
            <div id="category-buttons">
                <button onclick="showStats('setting')">Set</button>
                <button onclick="showStats('attacking')">Attack</button>
                <button onclick="showStats('serving')">Serve</button>
                <button onclick="showStats('passing')">Pass</button>
            </div>
        
            <!-- Stats Content -->
            <div id="stats-container">
                <p>Select a category above to view stats.</p>
            </div>
        </main>
        
    </div>

    <footer>
        <p>© 2024 Penn State Men's Volleyball</p>
    </footer>

    <script>
        const buttons = document.querySelectorAll('#category-buttons button');

        buttons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons
                buttons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to the clicked button
                button.classList.add('active');
            });
        });

        // Load player data from the players.json file
        fetch('static/player_data/players.json')
        .then(response => response.json())
        .then(players => {
            const playerSelector = document.getElementById('player-selector');
            players.forEach(player => {
                const option = document.createElement('option');
                option.value = player.name;
                option.textContent = player.name;
                playerSelector.appendChild(option);
            });
            
            updatePlayerProfile(players[0]);

        })
        .catch(error => {
            console.error('Error loading player data:', error);
        });

        const startDate = new Date("2024-09-02");
        const endDate = new Date("2024-11-22");
        const days = ["Mon", "Tue", "Wed", "Th", "Fr"];
        let currentWeekStart = new Date(startDate);

        function formatDate(date) {
            const month = date.getMonth() + 1; // Months are zero-indexed
            const day = date.getDate();
            return `${month}/${day}`;
        }



        function showStats(category) {
            const statsContainer = document.getElementById('stats-container');

            let statsContent = `<p>Select a category above to view stats.</p>`; // Default content

            if (category === "setting") {
                statsContent = `<p>Displaying setting stats...</p>`;
            } else if (category === "attacking") {
                statsContent = `<p>Displaying attacking stats...</p>`;
            } else if (category === "serving") {
                statsContent = `<p>Displaying serving stats...</p>`;
            } else if (category === "passing") {
                statsContent = `<p>Displaying passing stats...</p>`;
            }

            statsContainer.innerHTML = statsContent;
        }

        function updatePlayerProfile() {
            const selectedPlayerName = document.getElementById('player-selector').value;
            
            fetch('static/player_data/players.json')
                .then(response => response.json())
                .then(players => {
                    const player = players.find(p => p.name === selectedPlayerName);

                    const profile = document.getElementById('player-profile');
                    profile.innerHTML = `
                        <img src="${player.headshot}" alt="Player Headshot" class="headshot">
                        <h2>${player.name}</h2>
                        <p>#${player.jersey_number} - ${player.position}   |   ${player.class}</p>`;
                });
        }

        function nextWeek() {
            const nextWeekStart = new Date(currentWeekStart);
            nextWeekStart.setDate(currentWeekStart.getDate() + 7);

            if (nextWeekStart <= endDate) {
                currentWeekStart = nextWeekStart;

                // Re-render practices and weeks
                renderPractices(currentWeekStart, endDate);
                renderWeeks(new Date(currentWeekStart), endDate);
            }
        }

        function previousWeek() {
            const prevWeekStart = new Date(currentWeekStart);
            prevWeekStart.setDate(currentWeekStart.getDate() - 7);

            if (prevWeekStart >= startDate) {
                currentWeekStart = prevWeekStart;

                // Re-render practices and weeks
                renderPractices(currentWeekStart, endDate);
                renderWeeks(new Date(currentWeekStart), endDate);
            }
        }


        function toggleSection(activeSection) {
            const content = document.getElementById(`${activeSection}-content`);
            const section = document.getElementById(activeSection);

            // Check if the section is already visible
            if (content.style.display === 'block') {
                // Hide the section
                resetSections();
            } else {
                // Hide all other sections
                document.querySelectorAll('.content').forEach(content => content.style.display = 'none');
                document.querySelectorAll('.section').forEach(section => section.classList.add('inactive'));

                // Show the selected section
                content.style.display = 'block';
                section.classList.remove('inactive');
            }
        }

        function resetSections() {
            document.querySelectorAll('.content').forEach(content => content.style.display = 'none');
            document.querySelectorAll('.section').forEach(section => section.classList.remove('inactive'));
        }

        // Render the practices section
        function renderPractices(currentWeekStart, endDate) {
            const practiceBlocks = document.getElementById("practiceBlocks");
            practiceBlocks.innerHTML = ""; // Clear previous blocks

            for (let i = 0; i < 5; i++) { // 5 weekdays
                const practiceDate = new Date(currentWeekStart);
                practiceDate.setDate(currentWeekStart.getDate() + i + 1);

                const formattedDate = formatDate(practiceDate); // Format as "MM/DD"

                // Render only if the date exists in validPracticeDates
                if(formattedDate) {
                    const block = document.createElement("div");
                    block.className = "practice-block";
                    block.textContent = `${["M", "T", "W", "Th", "F"][i]} (${formattedDate})`;
                    block.onclick = () => togglePracticeSelection(formattedDate);

                    practiceBlocks.appendChild(block);
                }
            }
        }

        // Render the weeks section
        function renderWeeks(currentWeekStart, endDate) {
            const calendarGrid = document.querySelector(".calendar-grid");
            calendarGrid.innerHTML = ""; // Clear previous content

            let weekIndex = 1; // Start week count
            while (currentWeekStart <= endDate) {
                const weekStart = new Date(currentWeekStart);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 5); // Friday of the same week

                // Ensure the week end date doesn't exceed the endDate
                if (weekEnd.getMonth() !== weekStart.getMonth()) {
                    const endOfMonth = new Date(weekStart.getFullYear(), weekStart.getMonth() + 1, 0); // Last day of current month
                    weekEnd.setDate(endOfMonth.getDate()); // Adjust weekEnd to the last day of the current month
                }

                const weekRange = `${formatDate(weekStart)} - ${formatDate(weekEnd)}`;

                // Render only if the week range exists in validWeekRanges
                if (weekRange) {
                    const weekBox = document.createElement("div");
                    weekBox.className = "week-box";
                    weekBox.textContent = `Week ${weekIndex}`;
                    weekBox.title = `${weekRange}`;
                    weekBox.onclick = () => toggleWeekSelection(weekBox, weekRange);

                    calendarGrid.appendChild(weekBox);
                }

                currentWeekStart.setDate(currentWeekStart.getDate() + 7); // Move to next Monday
                weekIndex++;
            }
        }

        function renderMonths() {
            const monthsTable = document.querySelector(".months-table");

            const months = [
                { name: "September", start: "2024-09-02", end: "2024-09-30" },
                { name: "October", start: "2024-10-01", end: "2024-10-31" },
                { name: "November", start: "2024-11-01", end: "2024-11-22" },
            ];

            monthsTable.innerHTML = ""; // Clear table
            months.forEach(month => {
                const monthBox = document.createElement("div");
                monthBox.className = "month-box";
                monthBox.textContent = `${month.name}`;
                monthBox.onclick = () => toggleMonthSelection(month.name);

                monthsTable.appendChild(monthBox);
            });
        }
       
        renderPractices(currentWeekStart, endDate);
        renderWeeks(new Date(currentWeekStart), endDate);
        renderMonths();



        let selectedPractices = [];
        let selectedWeeks = [];
        let selectedMonths = [];

       

        function updateCalendarSelections() {
            // Highlight selected practices
            selectedPractices.forEach(date => {
                const practiceElement = document.querySelector(`.selected-time-calendar-day[data-date="${date}"]`);
                if (practiceElement) {
                    practiceElement.classList.add("selected-practice");
                }
            });

            // Highlight selected weeks
            selectedWeeks.forEach(weekRange => {
                const [startDate, endDate] = weekRange.split('-').map(date => date.trim());
                const [startMonth, startDay] = startDate.split('/').map(Number);
                const [endMonth, endDay] = endDate.split('/').map(Number);

                for (let day = startDay; day <= endDay; day++) {
                    const date = `${startMonth}/${day}`;
                    const weekElement = document.querySelector(`.selected-time-calendar-day[data-date="${date}"]`);
                    if (weekElement) {
                        weekElement.classList.add("selected-week");
                    }
                }
            });

            // Highlight selected months
            selectedMonths.forEach(monthName => {
                const monthHeaders = document.querySelectorAll('.selected-time-month-header');
                monthHeaders.forEach(header => {
                    if (header.textContent.trim() === monthName) {
                        const monthBox = header.closest(".selected-time-month-box");
                        const allDays = monthBox.querySelectorAll(".selected-time-calendar-day");
                        allDays.forEach(day => day.classList.add("selected-month"));
                    }
                });
            });
        }

        function updateSelectedTimePeriods() {
            // Clear all existing highlights
            document.querySelectorAll('.selected-practice, .selected-week, .selected-month').forEach(el => {
                el.classList.remove('selected-practice', 'selected-week', 'selected-month');
            });

            // Reapply highlights
            updateCalendarSelections();
        }

        function togglePracticeSelection(date) {
            // Check if the date is already selected
            if (selectedPractices.includes(date)) {
                // Remove the date from selectedPractices
                selectedPractices = selectedPractices.filter(practice => practice !== date);
            } else {
                // Add the date to selectedPractices
                selectedPractices.push(date);
            }
            console.log("Current Selected Practices:", selectedPractices);
            updateSelectedTimePeriods(); // Update the calendar display
        }

        function toggleWeekSelection(weekBox, weekRange) {
            // Toggle the "selected" class visually
            weekBox.classList.toggle("selected");

            if (weekBox.classList.contains("selected")) {
                // Add the weekRange to selectedWeeks if it's not already there
                if (!selectedWeeks.includes(weekRange)) {
                    selectedWeeks.push(weekRange);
                }
            } else {
                // Remove the weekRange from selectedWeeks
                selectedWeeks = selectedWeeks.filter(week => week !== weekRange);
            }

            console.log("Current Selected Weeks:", selectedWeeks);
            updateSelectedTimePeriods(); // Update the calendar display
        }

        function toggleMonthSelection(monthName) {
            // Check if the month is already selected
            if (selectedMonths.includes(monthName)) {
                // Remove the month from selectedMonths
                selectedMonths = selectedMonths.filter(month => month !== monthName);
            } else {
                // Add the month to selectedMonths
                selectedMonths.push(monthName);
            }
            console.log("Current Selected Months:", selectedMonths);
            updateSelectedTimePeriods(); // Update the calendar display
        }

    </script>
</body>
</html>